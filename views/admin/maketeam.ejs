<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <title></title>
    <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" 
integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" 
integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="http://code.jquery.com/jquery-2.0.3.min.js" data-semver="2.0.3" data-require="jquery"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables_themeroller.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" />
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_table_jui.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_table.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_page.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link data-require="jqueryui@*" data-semver="1.10.0" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.0/css/smoothness/jquery-ui-1.10.0.custom.min.css" /> -->
<script data-require="jqueryui@*" data-semver="1.10.0" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.0/jquery-ui.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/jquery.dataTables.js" data-semver="1.9.4" data-require="datatables@*"></script>
<link rel="stylesheet" href="./css/style.css">
  </head>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="/admincontrols">Home </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/taskdetails">Reports</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/addproject">Add Project</a>
          </li>
        <li class="nav-item" style="margin-left:1100px;">
          <a class="nav-link" style ='color:red;font-size: xx-large;font-family: sans-serif;' href="/adminlogout">Logout</a>
        </li>
        
      </ul>
    </div>
  </nav>

 

  <div>
    <table class="table table-hover table-dark"  >
        <thead style="margin: 0px; padding: 0px">
            <tr >
                <th scope="row" style="font-size: 25px;text-decoration: underline;">Project Name</th>
                <!-- <th scope="row">Assigned By</th> -->
                <th scope="row"  style="font-size: 25px;text-decoration: underline;">Task</th>
                <th scope="row"  style="font-size: 25px;text-decoration: underline;">Assigned To</th>
                <th scope="row"  style="font-size: 25px;text-decoration: underline;">Status</th>
            </tr>   
        </thead>
        <form action="/assignproject" method="post" id="assignForm" enctype="multipart/form-data"style="margin: 0px; padding: 0px">
            <tbody id="assignedList" style="background-color: black; border: 1px solid white;margin:0px;padding: 0px;">   
                <tr>
                 
                    <td  >  
                      <select name="projectName"id="parentselect" style="width:200px; font-size: 20px; background-color: black;">
                        <%project.forEach((ele)=>{%>
                          <option data-state="<%= ele.projectName %>"  value="<%= ele.projectName %>"><%= ele.projectName %> </option>
                          <%})%>
                      </select>
                    </td>
                 

                  
                  <td  >
                      <select name="task"id="childselect" style="width:200px;font-size: 20px;background-color: black;">
                        <%project.forEach((ele)=>{%>
                          <% ele.task.forEach((task)=>{%>
                              <option data-state="<%= ele.projectName %>" value="<%=task%>"><%= task%></option>
                              <%})%>
                          <%})%>
                      </select>
                  </td>
                      <td>
                      <select name="employee" style="width:200px;font-size: 20px;background-color: black;">
                      <% employees.forEach((employee)=>{%>
                          <option value="<%= employee.username%>"><%= employee.username%></option>
                      <%})%>
                  </select>
              </td>
              <td><button type="submit"  onclick="window.parent.location.reload()" id="assignBtn" class="btn btn-info">Assign</button></td>

                 
                    
                </tr>     
            </tbody>
    </form>
    <div id="success"></div>
    </table>
</div> 
<div>
  <!-- <p id="date_filter" style="margin-top: 50px; margin-left: 50px;" >
    <span id="date-label-from"   class="date-label">From: </span><input class="date_range_filter date"
     type="text" id="datepicker_from" />
    <span id="date-label-to" class="date-label">To:<input class="date_range_filter date" type="text" id="datepicker_to"  />
</p> -->
    <table class="table table-bordered table-hover"  id="datatable" style="margin: 10px;width: 98%;">
      <thead class="table table-dark" >
        <tr>
          <th scope="col" >Assigned Date</th>
          <th scope="col" >Project</th>
          <th scope="col">Task</th>
          <th scope="col">Asigned To</th>
        
          
        </tr>
      </thead>
      <tbody>
             <% assignedtask.forEach(function(employee){%>
                        <% employee.task.forEach(function(tasks){%>

                            <tr class="rowSelect">
                            <td id="user"><%= employee.date.toString().substring(0,16)%></td>
                            <td class="employeeName"><%= employee.projectName %></td>
                            <td ><%= tasks %></td>
                            <td><%= employee.assignedTo %></td>
                            <!-- <td><%= employee.teamLeader %></td> -->
                        </tr>
                    <% }) %>
                <% }) %>


      </tbody>
    </table>
    <!-- <button class="btn btn-success" onclick="exportData()">
        <span class="glyphicon glyphicon-download "></span>
        Download list</button>

</div> -->

    <script>
// find and search by range 
$(function() {
    var oTable = $('#datatable').DataTable({
      "oLanguage": {
        "sSearch": "Search:"
      },
      "iDisplayLength": -1,
      "sPaginationType": "full_numbers",
  
    });
  
    var $selectState = $('#parentselect'),
		$selectDistrict = $('#childselect'),
    $options = $selectDistrict.find('option');
    
$selectState.on('change', function() {
	$selectDistrict.html($options.filter('[data-state="'+this.value+'"]'));
}).trigger('change');
    $("#datepicker_from").datepicker({
      showOn: "button",
      // buttonImage: "../css/img/calendaricon.jpg",
      buttonImageOnly: false,
      "onSelect": function(date) {
        minDateFilter = new Date(date).getTime();
        oTable.fnDraw();
      }
    }).keyup(function() {
      minDateFilter = new Date(this.value).getTime();
      oTable.fnDraw();
    });
  
    $("#datepicker_to").datepicker({
      showOn: "button",
      // buttonImage: "images/calendar.gif",
      buttonImageOnly: false,
      "onSelect": function(date) {
        maxDateFilter = new Date(date).getTime();
        oTable.fnDraw();
      }
    }).keyup(function() {
      maxDateFilter = new Date(this.value).getTime();
      oTable.fnDraw();
    });
  
  });
  
  // Date range filter
  minDateFilter = "";
  maxDateFilter = "";
  
  $.fn.dataTableExt.afnFiltering.push(
    function(oSettings, aData, iDataIndex) {
      if (typeof aData._date == 'undefined') {
        aData._date = new Date(aData[0]).getTime();
      }
  
      if (minDateFilter && !isNaN(minDateFilter)) {
        if (aData._date < minDateFilter) {
          return false;
        }
      }
  
      if (maxDateFilter && !isNaN(maxDateFilter)) {
        if (aData._date > maxDateFilter) {
          return false;
        }
      }
  
      return true;
    }
  );



//  for download the data 
    function exportData(){
    /* Get the HTML data using Element by Id */
    var table = document.getElementById("datatable");
 
    /* Declaring array variable */
    var rows =[];
 
      //iterate through rows of table
    for(var i=0,row; row = table.rows[i];i++){
        //rows would be accessed using the "row" variable assigned in the for loop
        //Get each cell value/column from the row
        column1 = row.cells[0].innerText;
        column2 = row.cells[1].innerText;
        column3 = row.cells[2].innerText;
        column4 = row.cells[3].innerText;
        column5 = row.cells[4].innerText;
        column6 = row.cells[5].innerText;
 
    /* add a new records in the array */
        rows.push(
            [
                column1,
                column2,
                column3,
                column4,
                column5,
                column6
                
              
            ]
        );
 
        }
        csvContent = "data:text/csv;charset=utf-8,";
         /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
        rows.forEach(function(rowArray){
            row = rowArray.join(",");
            csvContent += row + "\r\n";
        });
 
        /* create a hidden <a> DOM node and set its download attribute */
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "report.csv");
        document.body.appendChild(link);
         /* download the data file named "Stock_Price_Report.csv" */
        link.click();
}

const assignTask = document.getElementById('assignTask');
    const submitForm = document.getElementById('assignForm');
    // const userName  = document.getElementsByClassName('userName');
    const assignedList = document.getElementById('assignedList');
    
  

const employeeName = document.getElementsByClassName('employeeName')
const selectemployees = document.getElementById('selectemployee')


const userName = document.getElementById('user')

const rowSelect = document.getElementsByClassName('rowSelect')

rowSelect[0].addEventListener('click',()=>{

    
})

</script>
<script type="text/javascript">

    $(document).ready(function(){

        $( "#assignForm" ).submit(function(event) {
            event.preventDefault();

            $.ajax({
                type: 'POST',
                url: '/assignproject',
                data: $('#assignForm').serialize(),
                dataType: "json",
                success: function(response){
                    //alert("a");
                    //console.log(response.Success);
                    $('#assignForm')[0].reset();

                    document.getElementById("success").innerHTML=response.Success;
                         //ADD THIS CODE
                         setTimeout(function(){
                             document.getElementById("success").innerHTML="";
                         },3000);
                         if (response.Success=="Success!") {
                             document.getElementById("assignBtn").click();
                         };
                     },
                     error: function() {
                     }
                 })
        });

    });

    </script>
   
  </body>

</html>